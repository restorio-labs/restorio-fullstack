# Database Migrations

This project uses **Alembic** for database migrations with SQLAlchemy ORM.

## Running Migrations

### Apply all pending migrations

```bash
make migrate
# or
uv run alembic upgrade head
```

### Create a new migration

```bash
make migrate-create NAME="add_user_profile"
# or
uv run alembic revision --autogenerate -m "add_user_profile"
```

### Show migration history

```bash
make migrate-history
# or
uv run alembic history
```

### Show current migration version

```bash
make migrate-current
# or
uv run alembic current
```

### Downgrade one migration

```bash
make migrate-downgrade
# or
uv run alembic downgrade -1
```

## How It Works

- Alembic automatically detects changes in SQLAlchemy ORM models
- Migrations are stored in `alembic/versions/`
- Configuration is in `alembic.ini` and `alembic/env.py`
- Uses async SQLAlchemy engine from `core.database`

## Best Practices

1. **Always review autogenerated migrations** - Alembic may not catch all changes
2. **Test migrations** on a development database first
3. **Never modify existing migration files** - Create new migrations for changes
4. **Backup database** before running migrations in production
5. **Use descriptive migration names** - e.g., "add_user_email_index"

## Migration Files

Migration files are auto-generated in `alembic/versions/` with format:

- `{revision}_{description}.py`

## Schema Documentation

See `docs/postgres_schema.md` for complete schema documentation and ERD.
